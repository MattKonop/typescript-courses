{
    "componentChunkName": "component---src-templates-blog-post-tsx",
    "path": "/course/full-stack-typescript/11-nested-data copy/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Learn TypeScript w/ Mike North","courses":[{"id":"fundamentals-v3","name":"TypeScript Fundamentals v3","summary":"Learn everything you need to know in order to confidently and successfully use TypeScript to build a modern JavaScript app."},{"id":"fundamentals-v4","name":"TypeScript Fundamentals v4","summary":"Learn everything you need to know in order to confidently and successfully use TypeScript to build a modern JavaScript app."},{"id":"intermediate-v1","name":"Intermediate TypeScript v1","summary":"Leverage TypeScript's strengths to provide clarity in the face of\ncomplexity, while protecting your codebase and team from it's weaknesses.\n"},{"id":"intermediate-v2","name":"Intermediate TypeScript v2","summary":"Leverage TypeScript's strengths to provide clarity in the face of\ncomplexity, while protecting your codebase and team from it's weaknesses.\n"},{"id":"making-typescript-stick","name":"Making TypeScript Stick","summary":"Tackle a series of challenges designed to reinforce your knowledge and make\nthe important concepts truly \"stick\" in your mind.\n"},{"id":"enterprise-v2","name":"Enterprise TypeScript v2","summary":"Combine TypeScript and GraphQL's type systems to create full-stack, fully\ntype-checked code bases that are shockingly easy to refactor and maintain.\n"},{"id":"full-stack-typescript","name":"Full Stack TypeScript","summary":"Combine TypeScript and GraphQL's type systems to create full-stack, fully\ntype-checked code bases that are shockingly easy to refactor and maintain.\n"}]}},"markdownRemark":{"id":"36584d3e-f483-5959-8e9d-ba5c83458c49","excerpt":"Schema Update your graphql.schema by adding the following Run yarn codegen in both the client and server sub-projects to get\nupdated TS types that include this…","html":"<h2 id=\"schema\" style=\"position:relative;\"><a href=\"#schema\" aria-label=\"schema permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Schema</h2>\n<p>Update your <code>graphql.schema</code> by adding the following</p>\n<pre class=\"shiki github-light\" style=\"background-color: #ffffff; color: #24292f\"><div class=\"language-id\">graphql</div><div class='code-container'><code><div class='line'><span style=\"color: #CF222E\">type</span><span style=\"color: #24292F\"> </span><span style=\"color: #0550AE\">Mutation</span><span style=\"color: #24292F\"> {</span></div><div class='line'><span style=\"color: #24292F\">  </span><span style=\"color: #953800\">createTweet</span><span style=\"color: #24292F\">(</span><span style=\"color: #953800\">userId</span><span style=\"color: #24292F\">: </span><span style=\"color: #0550AE\">String</span><span style=\"color: #CF222E\">!</span><span style=\"color: #24292F\">, </span><span style=\"color: #953800\">body</span><span style=\"color: #24292F\">: </span><span style=\"color: #0550AE\">String</span><span style=\"color: #CF222E\">!</span><span style=\"color: #24292F\">): </span><span style=\"color: #0550AE\">Tweet</span><span style=\"color: #CF222E\">!</span></div><div class='line'><span style=\"color: #24292F\">}</span></div></code></div></pre>\n<p>Run <code>yarn codegen</code> in both the <code>client</code> and <code>server</code> sub-projects to get\nupdated TS types that include this mutation</p>\n<h2 id=\"mutation-resolver\" style=\"position:relative;\"><a href=\"#mutation-resolver\" aria-label=\"mutation resolver permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mutation Resolver</h2>\n<p>Create a new dedicated file for your <code>Mutation</code> resolvers <code>server/src/resolvers/Mutation.ts</code></p>\n<pre class=\"shiki github-light\" style=\"background-color: #ffffff; color: #24292f\"><div class=\"language-id\">ts</div><div class='code-container'><code><div class='line'><span style=\"color: #CF222E\">import</span><span style=\"color: #24292F\"> { tweetTransform } </span><span style=\"color: #CF222E\">from</span><span style=\"color: #24292F\"> </span><span style=\"color: #0A3069\">\"../transforms\"</span></div><div class='line'><span style=\"color: #CF222E\">import</span><span style=\"color: #24292F\"> { TwitterResolverContext } </span><span style=\"color: #CF222E\">from</span><span style=\"color: #24292F\"> </span><span style=\"color: #0A3069\">\"../resolvers\"</span></div><div class='line'><span style=\"color: #CF222E\">import</span><span style=\"color: #24292F\"> { MutationResolvers } </span><span style=\"color: #CF222E\">from</span><span style=\"color: #24292F\"> </span><span style=\"color: #0A3069\">\"../resolvers-types.generated\"</span></div><div class='line'></div><div class='line'><span style=\"color: #CF222E\">const</span><span style=\"color: #24292F\"> </span><span style=\"color: #0550AE\">mutationTwitterResolver</span><span style=\"color: #CF222E\">:</span><span style=\"color: #24292F\"> </span><span style=\"color: #953800\">MutationResolvers</span><span style=\"color: #24292F\">&lt;</span><span style=\"color: #953800\">TwitterResolverContext</span><span style=\"color: #24292F\">&gt; </span><span style=\"color: #CF222E\">=</span></div><div class='line'><span style=\"color: #24292F\">  {</span></div><div class='line'><span style=\"color: #24292F\">    </span><span style=\"color: #CF222E\">async</span><span style=\"color: #24292F\"> </span><span style=\"color: #8250DF\">createTweet</span><span style=\"color: #24292F\">(</span><span style=\"color: #953800\">_parent</span><span style=\"color: #24292F\">, </span><span style=\"color: #953800\">args</span><span style=\"color: #24292F\">, { </span><span style=\"color: #953800\">dbTweetCache</span><span style=\"color: #24292F\">, </span><span style=\"color: #953800\">db</span><span style=\"color: #24292F\"> }) {</span></div><div class='line'><span style=\"color: #24292F\">      </span><span style=\"color: #CF222E\">const</span><span style=\"color: #24292F\"> { </span><span style=\"color: #0550AE\">body</span><span style=\"color: #24292F\">, </span><span style=\"color: #0550AE\">userId</span><span style=\"color: #24292F\"> } </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> args</span></div><div class='line'><span style=\"color: #24292F\">      </span><span style=\"color: #CF222E\">const</span><span style=\"color: #24292F\"> </span><span style=\"color: #0550AE\">dbTweet</span><span style=\"color: #24292F\"> </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> </span><span style=\"color: #CF222E\">await</span><span style=\"color: #24292F\"> db.</span><span style=\"color: #8250DF\">createTweet</span><span style=\"color: #24292F\">({</span></div><div class='line'><span style=\"color: #24292F\">        message: body,</span></div><div class='line'><span style=\"color: #24292F\">        userId,</span></div><div class='line'><span style=\"color: #24292F\">      })</span></div><div class='line'><span style=\"color: #24292F\">      </span><span style=\"color: #CF222E\">const</span><span style=\"color: #24292F\"> </span><span style=\"color: #0550AE\">dbTweetMap</span><span style=\"color: #24292F\"> </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> (dbTweetCache </span><span style=\"color: #CF222E\">||=</span><span style=\"color: #24292F\"> {})</span></div><div class='line'><span style=\"color: #24292F\">      dbTweetMap[dbTweet.id] </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> dbTweet</span></div><div class='line'><span style=\"color: #24292F\">      </span><span style=\"color: #CF222E\">return</span><span style=\"color: #24292F\"> </span><span style=\"color: #8250DF\">tweetTransform</span><span style=\"color: #24292F\">(dbTweet)</span></div><div class='line'><span style=\"color: #24292F\">    },</span></div><div class='line'><span style=\"color: #24292F\">  }</span></div><div class='line'></div><div class='line'><span style=\"color: #CF222E\">export</span><span style=\"color: #953800\"> </span><span style=\"color: #CF222E\">default</span><span style=\"color: #953800\"> </span><span style=\"color: #24292F\">mutationTwitterResolver</span></div></code></div></pre>\n<p>and in <code>server/src/resolvers.ts</code> add it to the main resolver object</p>\n<pre class=\"shiki github-light\" style=\"background-color: #ffffff; color: #24292f\"><div class=\"language-id\">diff</div><div class='code-container'><code><div class='line'><span style=\"color: #116329\">+import mutationTwitterResolver from './resolvers/Mutation';</span></div><div class='line'></div><div class='line'><span style=\"color: #24292F\">  const resolvers = {</span></div><div class='line'><span style=\"color: #24292F\">    Query: queryTwitterResolver,</span></div><div class='line'><span style=\"color: #116329\">+   Mutation: mutationTwitterResolver,</span></div><div class='line'><span style=\"color: #24292F\">    Tweet: tweetTwitterResolver,</span></div></code></div></pre>\n<h2 id=\"compose-panel\" style=\"position:relative;\"><a href=\"#compose-panel\" aria-label=\"compose panel permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Compose Panel</h2>\n<p>Open the Compose Panel component <code>client/src/ComposePanel.tsx</code> and add the\nfollowing imports</p>\n<pre class=\"shiki github-light\" style=\"background-color: #ffffff; color: #24292f\"><div class=\"language-id\">ts</div><div class='code-container'><code><div class='line'><span style=\"color: #CF222E\">import</span><span style=\"color: #24292F\"> { gql } </span><span style=\"color: #CF222E\">from</span><span style=\"color: #24292F\"> </span><span style=\"color: #0A3069\">\"@apollo/client\"</span></div><div class='line'><span style=\"color: #CF222E\">import</span><span style=\"color: #24292F\"> { useCreateNewTweetMutation } </span><span style=\"color: #CF222E\">from</span><span style=\"color: #24292F\"> </span><span style=\"color: #0A3069\">\"./generated/graphql\"</span></div></code></div></pre>\n<p>Add this new query to top-level module scope</p>\n<pre class=\"shiki github-light\" style=\"background-color: #ffffff; color: #24292f\"><div class=\"language-id\">ts</div><div class='code-container'><code><div class='line'><span style=\"color: #CF222E\">export</span><span style=\"color: #24292F\"> </span><span style=\"color: #CF222E\">const</span><span style=\"color: #24292F\"> </span><span style=\"color: #0550AE\">CREATE_NEW_TWEET</span><span style=\"color: #24292F\"> </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> </span><span style=\"color: #8250DF\">gql</span><span style=\"color: #0A3069\">`</span></div><div class='line'><span style=\"color: #0A3069\">  mutation CreateNewTweet(</span></div><div class='line'><span style=\"color: #0A3069\">    $userId: String!</span></div><div class='line'><span style=\"color: #0A3069\">    $body: String!</span></div><div class='line'><span style=\"color: #0A3069\">  ) {</span></div><div class='line'><span style=\"color: #0A3069\">    createTweet(userId: $userId, body: $body) {</span></div><div class='line'><span style=\"color: #0A3069\">      id</span></div><div class='line'><span style=\"color: #0A3069\">    }</span></div><div class='line'><span style=\"color: #0A3069\">  }</span></div><div class='line'><span style=\"color: #0A3069\">`</span></div></code></div></pre>\n<p>delete the entire existing <code>createNewTweet</code> function and replace it with</p>\n<pre class=\"shiki github-light\" style=\"background-color: #ffffff; color: #24292f\"><div class=\"language-id\">ts</div><div class='code-container'><code><div class='line'><span style=\"color: #CF222E\">const</span><span style=\"color: #24292F\"> [</span><span style=\"color: #0550AE\">createNewTweet</span><span style=\"color: #24292F\">, { </span><span style=\"color: #0550AE\">error</span><span style=\"color: #24292F\"> }] </span><span style=\"color: #CF222E\">=</span></div><div class='line'><span style=\"color: #24292F\">  </span><span style=\"color: #8250DF\">useCreateNewTweetMutation</span><span style=\"color: #24292F\">()</span></div><div class='line'><span style=\"color: #CF222E\">if</span><span style=\"color: #24292F\"> (error) </span><span style=\"color: #CF222E\">return</span><span style=\"color: #24292F\"> &lt;</span><span style=\"color: #953800\">p</span><span style=\"color: #24292F\">&gt;</span><span style=\"color: #0550AE\">Error</span><span style=\"color: #24292F\"> creating </span><span style=\"color: #CF222E\">new</span><span style=\"color: #24292F\"> tweet: {error}</span><span style=\"color: #CF222E\">&lt;/</span><span style=\"color: #24292F\">p</span><span style=\"color: #CF222E\">&gt;</span></div></code></div></pre>\n<p>and make this change to the <code>handleSubmit</code> function</p>\n<pre class=\"shiki github-light\" style=\"background-color: #ffffff; color: #24292f\"><div class=\"language-id\">diff</div><div class='code-container'><code><div class='line'><span style=\"color: #82071E\">-   createNewTweet(body);</span></div><div class='line'><span style=\"color: #82071E\">-   textarea.value = '';</span></div><div class='line'><span style=\"color: #116329\">+   createNewTweet({</span></div><div class='line'><span style=\"color: #116329\">+     variables: { userId: currentUser.id, body }}).then(() =&gt; {</span></div><div class='line'><span style=\"color: #116329\">+       textarea.value = '';</span></div><div class='line'><span style=\"color: #116329\">+     })</span></div><div class='line'><span style=\"color: #116329\">+     .catch((err: unknown) =&gt; {</span></div><div class='line'><span style=\"color: #116329\">+       console.error('Problem creating new tweet', err);</span></div><div class='line'><span style=\"color: #116329\">+     });</span></div></code></div></pre>\n<p>Try creating a new tweet, pressing the blue button to send the API call</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e286198bf74144f2bc6f7bbf7b810d0c/229ad/create-tweet.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.599999999999994%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA0ElEQVQoz62Ou2oCURRFbykomDJBm+n1FwbEKhbp/AH/ZB7YCFZxsDB/k9I+TSCVlcxMMcV93yVKDIEUjpB1WOzmcM4Ww+GMh/6U8WjOYDDj6fGZOF4QRS90OjG93oRut70iywrStGC12l0yzwvW6zeWyy1J8kqablqbJBsEeMBijOI/EEpppFRIKdFa45z/pbut/c7gUUafG/4lhNDe8+gAR3C1RZRlSVVV1HVN0zSXb9ejt/hZUZDvNfsPjTDGcNVai/f+7oaYwPun4/BlOAHfAdquunf/6AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"create-tweet\"\n        title=\"create-tweet\"\n        src=\"/static/e286198bf74144f2bc6f7bbf7b810d0c/00d43/create-tweet.png\"\n        srcset=\"/static/e286198bf74144f2bc6f7bbf7b810d0c/63868/create-tweet.png 250w,\n/static/e286198bf74144f2bc6f7bbf7b810d0c/0b533/create-tweet.png 500w,\n/static/e286198bf74144f2bc6f7bbf7b810d0c/00d43/create-tweet.png 1000w,\n/static/e286198bf74144f2bc6f7bbf7b810d0c/229ad/create-tweet.png 1356w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>There’s a bug!</strong> Nothing happens in the UI when new tweets are created.\nHowever, if you refresh the page, you can see that the data actually ends up\nbeing persisted.</p>\n<h2 id=\"bug-fix\" style=\"position:relative;\"><a href=\"#bug-fix\" aria-label=\"bug fix permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bug Fix</h2>\n<p>We need to tell apollo that the <code>GET_TIMELINE_TWEETS</code> query\nneeds to be re-fetched when we click the “create tweet” button</p>\n<p>This is quick and easy with Apollo</p>\n<p>In <code>client/src/ComposePanel.tsx</code> import the query we want to refresh</p>\n<pre class=\"shiki github-light\" style=\"background-color: #ffffff; color: #24292f\"><div class=\"language-id\">ts</div><div class='code-container'><code><div class='line'><span style=\"color: #CF222E\">import</span><span style=\"color: #24292F\"> { GET_TIMELINE_TWEETS } </span><span style=\"color: #CF222E\">from</span><span style=\"color: #24292F\"> </span><span style=\"color: #0A3069\">'./Timeline'</span><span style=\"color: #24292F\">;</span></div></code></div></pre>\n<p>And then make the following change to the invocation of <code>createNewTweet</code></p>\n<pre class=\"shiki github-light\" style=\"background-color: #ffffff; color: #24292f\"><div class=\"language-id\">diff</div><div class='code-container'><code><div class='line'><span style=\"color: #24292F\">    createNewTweet({</span></div><div class='line'><span style=\"color: #24292F\">      variables: { userId: currentUser.id, body },</span></div><div class='line'><span style=\"color: #116329\">+     refetchQueries: [GET_TIMELINE_TWEETS],</span></div><div class='line'><span style=\"color: #24292F\">    }).then(() =&gt; {</span></div></code></div></pre>\n<p>Try to create a new tweet again. It should work now!</p>","tableOfContents":"<ul>\n<li><a href=\"#schema\">Schema</a></li>\n<li><a href=\"#mutation-resolver\">Mutation Resolver</a></li>\n<li><a href=\"#compose-panel\">Compose Panel</a></li>\n<li><a href=\"#bug-fix\">Bug Fix</a></li>\n</ul>","fields":{"slug":"/course/full-stack-typescript/11-nested-data copy/"},"frontmatter":{"title":"Mutations","course":"full-stack-typescript","date":"March 24, 2022","description":"We'll create new data for the first time, using a GraphQL mutation for the \"post a new tweet\" feature\n"}}},"pageContext":{"slug":"/course/full-stack-typescript/11-nested-data copy/","title":"Mutations","course":"full-stack-typescript","order":11,"previous":{"fields":{"slug":"/course/full-stack-typescript/10-nested-data/"},"frontmatter":{"title":"Nested data","order":10,"course":"full-stack-typescript","isExercise":null}},"next":{"fields":{"slug":"/course/full-stack-typescript/12-favorites/"},"frontmatter":{"title":"Favorites","order":12,"course":"full-stack-typescript","isExercise":null}}}},
    "staticQueryHashes": ["2785745750","2841359383"]}